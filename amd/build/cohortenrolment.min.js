/*
  2016 Damyon Wiese <damyon@moodle.com>
 @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,g){a instanceof String&&(a=String(a));for(var h=a.length,f=0;f<h;f++){var k=a[f];if(d.call(g,k,f,a))return{i:f,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,g){a!=Array.prototype&&a!=Object.prototype&&(a[d]=g.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,g,h){if(d){g=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var f=a[h];f in g||(g[f]={});g=g[f]}a=a[a.length-1];h=g[a];d=d(h);d!=h&&null!=d&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,g){return $jscomp.findInternal(this,a,g).v}},"es6","es3");
define("core/templates jquery core/str core/config core/notification core/modal_factory core/modal_events core/fragment".split(" "),function(a,d,g,h,f,k,l,m){var e=function(b){this.course_id=b.course_id;this.instance=b.instance;this.start_dates=b.start_dates;this.role_default=b.role_default;this.init()};e.prototype.modal=null;e.prototype.page=0;e.prototype.perpage=25;e.prototype.course_id=0;e.prototype.role_default=0;e.prototype.enrol_count=0;e.prototype.assignales_roles=[];e.prototype.instance=[];
e.prototype.start_dates=[];e.prototype.groups=[];e.prototype.require_refresh=!1;e.prototype.init=function(){var b=d("button#enrol_simplesco_addcohort");d.when(g.get_strings([{component:"enrol_simplesco",key:"enrolcohorttitle"},{component:"enrol_simplesco",key:"btnclosecohort"},{component:"role",key:"assignroles"},{component:"enrol",key:"none"},{component:"enrol",key:"enrolmentoptions"},{component:"moodle",key:"startingfrom"},{component:"enrol",key:"enrolperiod"},{component:"enrol",key:"unlimitedduration"},
{component:"enrol_simplesco",key:"searchoption"},{component:"enrol",key:"usersearch"},{component:"enrol_simplesco",key:"noresultliste"},{component:"enrol_simplesco",key:"allresultliste"},{component:"enrol_simplesco",key:"ajaxxcohortfound"},{component:"enrol",key:"ajaxnext25"},{component:"enrol",key:"enrol"},{component:"enrol_simplesco",key:"cohort"},{component:"enrol_cohort",key:"addgroup"}]),k.create({type:k.types.DEFAULT,large:!0},b)).then(function(b,a){this.strings=b;this.modal=a;a.setTitle(b[0]);
var d='<div class="form-inline mform simplesco"><div class="form-group">'+('<label for="enrol_simplesco_assignable_roles">'+b[2]+" : </label>");d+='<select id="enrol_simplesco_assignable_roles"><option value="">'+b[3]+"</option></select>";d=d+'</div><fieldset class="collapsible collapsed" id="enrolment_options">'+('<legend class="ftoggler"><a href="#" class="fheader" role="button" aria-controls="enrolment_options" aria-expanded="false">'+b[4]+"</a></legend>");d=d+'<div class="fcontainer">'+('<div class="startdate form-group"><label for="enrol_simplesco_assignable_startdate">'+
b[5]+':</label> <select id="enrol_simplesco_assignable_startdate"></select></div>');d+='<div class="duration form-group"><label for="enrol_simplesco_assignable_duration">'+b[6]+' :</label> <select id="enrol_simplesco_assignable_duration"><option value="0" selected="selected">'+b[7]+"</option></select></div>";d=d+'</div></fieldset><fieldset class="collapsible collapsed" id="enrolment_options">'+('<legend class="ftoggler"><a href="#" class="fheader" role="button" aria-controls="enrolment_options" aria-expanded="false">'+
b[8]+"</a></legend>");d=d+'<div class="fcontainer">'+('<label for="enrolusersearch">'+b[9]+' :</label> <input type="text" id="enrolusersearch" value="" class="form-control"/>');d=d+"</div></fieldset>"+('<div class="text-center"><button class="btn btn-primary" id="search"> '+b[9]+"</button></div>");a.setBody(d+'<div id="results"></div><div id="loading" style="display:none;">CHARGEMENT</div></div>');a.setFooter('<button class="btn btn-primary" data-action="hide">'+b[1]+"</button>");a.getRoot().on(l.hidden,
function(){c.require_refresh&&location.reload()});this.bindEvents();this.populateRoles();this.updateStartDateList();this.updateDurationsList()}.bind(this)).fail(f.exception);var c=this};e.prototype.bindEvents=function(){var b=this;d("body").on("click","button#enrol_simplesco_addcohort",function(){b.modal.show();b.modal.getBody().find("button#search").trigger("click")});this.modal.getBody().find(".collapsible .ftoggler a").on("click",function(c){c.preventDefault();d(this).closest(".collapsible").toggleClass("collapsed");
return!1});this.modal.getBody().find("button#search").on("click",function(c){c.preventDefault();b.search();return!1});this.modal.getBody().find("input#enrolusersearch").on("keypress",function(c){if(13===c.which)return c.preventDefault(),b.search(),!1});this.modal.getBody().on("click",'button[data-toggle="load-more"]',function(c){c.preventDefault();b.search(!0);return!1});this.modal.getBody().on("click",'button[data-toggle="enrol"]',function(c){c.preventDefault();c=d(this).attr("value");b.enrol(c);
return!1})};e.prototype.enrol=function(b){var c=this,a={id:this.course_id,sesskey:M.cfg.sesskey,action:"enrolcohort",enrolid:this.instance.id,cohortid:b,groupeid:this.modal.getBody().find('select[name="cohort_group"][rel="'+b+'"]').val(),role:this.modal.getBody().find("select#enrol_simplesco_assignable_roles").val(),startdate:this.modal.getBody().find("select#enrol_simplesco_assignable_startdate").val(),duration:this.modal.getBody().find("select#enrol_simplesco_assignable_duration").val(),recovergrades:0};
d.ajax({url:M.cfg.wwwroot+"/enrol/simplesco/ajax.php",method:"POST",dataType:"json",data:build_querystring(a),success:function(a,d){if(a.error)return f.exception(a);c.require_refresh=!0;c.enrol_count++;c.modal.getBody().find("div#results").find('div.cohort[rel="'+b+'"]').addClass("enrolled")},error:function(c,b,a){f.exception(a)},beforeSend:function(){c.startLoading()}}).always(function(){c.stopLoading()})};e.prototype.populateRoles=function(){if(0<this.assignales_roles.length)return this.updateRolesList();
var b=this;d.ajax({url:M.cfg.wwwroot+"/enrol/ajax.php",method:"POST",dataType:"json",data:"id="+this.course_id+"&action=getassignable&sesskey="+M.cfg.sesskey,success:function(c,a){if(c.error)return f.exception(c);b.assignales_roles=c.response;b.updateRolesList()},error:function(c,b,a){f.exception(a)},beforeSend:function(){b.startLoading()}}).always(function(){b.stopLoading()})};e.prototype.renderCohort=function(b){var c=this.modal.getBody().find("div#results").find(".cohort").length,a='<div class="cohort item clearfix" rel="'+
b.id+'">';a=a+('<div class="count">'+c+"</div>")+'<div class="details">'+('<div class="fullname">'+b.name+"</div>");a+="</div>";a+='<div class="options">';a+='<select name="cohort_group" rel="'+b.id+'">';for(var d in this.groups)a+='<option value="'+d+'">'+this.groups[d]+"</option>";a+="</select>";a+='<button class="btn btn-success" data-toggle="enrol" value="'+b.id+'">'+this.strings[14]+"</button>";a+="</div>";return a+="</div>"};e.prototype.search=function(a){var c=this;a?this.page++:this.page=
0;var b={id:this.course_id,sesskey:M.cfg.sesskey,action:"searchcohorts",search:this.modal.getBody().find("input#enrolusersearch").val(),page:this.page,perpage:this.perpage,enrolcount:this.enrol_count,enrolid:this.instance.id};c.modal.getBody().find("div#results").find('button[data-toggle="load-more"]').remove();d.ajax({url:M.cfg.wwwroot+"/enrol/simplesco/ajax.php",method:"POST",dataType:"json",data:build_querystring(b),success:function(b,d){if(b.error)return f.exception(b);a||(c.modal.getBody().find("div#results").html(""),
c.modal.getBody().find("div#results").append('<div class="total_results">'+c.strings[12].replace("{$a}",b.response.totalcohorts)+"</div>"),c.modal.getBody().find("div#results").append('<div class="item cohort clearfix"><div class="count">N\u00b0</div><div class="details">'+c.strings[14]+'</div><div class="options">'+c.strings[15]+"</div></div>"));c.groups=b.response.group;for(var e in b.response.cohorts)d=b.response.cohorts[e],c.modal.getBody().find("div#results").append(c.renderCohort(d));c.modal.getBody().find("div#results").find(".item").length<
b.response.totalcohorts&&c.modal.getBody().find("div#results").append('<div class="text-center"><button class="btn btn-secondary" data-toggle="load-more">'+c.strings[13]+"</button></div>");console.log(b.response.totalcohorts)},error:function(b,a,c){f.exception(c)},beforeSend:function(){c.startLoading()}}).always(function(){c.stopLoading()})};e.prototype.startLoading=function(){this.modal.getBody().find("#loading").show()};e.prototype.stopLoading=function(){this.modal.getBody().find("#loading").hide()};
e.prototype.updateRolesList=function(){var b=this.modal.getBody().find("select#enrol_simplesco_assignable_roles"),a;for(a in this.assignales_roles){var e=this.role_default==this.assignales_roles[a].id?'selected="selected"':"";d(b).append('<option value="'+this.assignales_roles[a].id+'" '+e+">"+this.assignales_roles[a].name+"</option>")}};e.prototype.updateDurationsList=function(){var a=this.modal.getBody().find("select#enrol_simplesco_assignable_duration");d.when(g.get_string("durationdays","enrol",
"{a}")).then(function(b){for(var c=1;365>=c;c++)d(a).append('<option value="'+c+'">'+b.replace("{a}",c)+"</option>")})};e.prototype.updateStartDateList=function(){var a=this.modal.getBody().find("select#enrol_simplesco_assignable_startdate"),c;for(c in this.start_dates)d(a).append('<option value="'+c+'">'+this.start_dates[c]+"</option>")};return{init:function(a){new e(a)}}});
